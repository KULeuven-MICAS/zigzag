<!DOCTYPE html> <html lang=en > <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=viewport  content="width=device-width, initial-scale=1" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="_static/stylesheets/application.css"/> <link rel=stylesheet  href="_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="_static/fonts/material-icons.css"/> <meta name=theme-color  content="#3f51b5"> <script src="_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXX"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XXXXX'); </script> <title>Stages &#8212; ZigZag 2.0.0 documentation</title> <link rel=stylesheet  type="text/css" href="_static/pygments.css?v=75810a84" /> <link rel=stylesheet  type="text/css" href="_static/material.css?v=79c92029" /> <script data-url_root="./" id=documentation_options  src="_static/documentation_options.js?v=73cda6fb"></script> <script src="_static/doctools.js?v=888ff710"></script> <script src="_static/sphinx_highlight.js?v=4825356b"></script> <link rel=icon  href="_static/zigzag_logo_white_32x32.svg"/> <link rel=index  title=Index  href=genindex.html  /> <link rel=search  title=Search  href=search.html  /> <link rel=next  title=Outputs  href=outputs.html  /> <link rel=prev  title=Mapping  href=mapping.html  /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=grey> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#stages" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href=index.html  title="ZigZag 2.0.0 documentation" class="md-header-nav__button md-logo"> &nbsp; </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >ZigZag Framework</span> <span class=md-header-nav__topic > Stages </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action=search.html  method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=""Search"" autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source > <a href="https://github.com/kuleuven-micas/zigzag" title="Go to repository" class=md-source  data-md-source=github > <div class=md-source__icon > <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width=28  height=28 > <use xlink:href="#__github" width=24  height=24 ></use> </svg> </div> <div class=md-source__repository > ZigZag Framework </div> </a> </div> </div> <script src="_static/javascripts/version_dropdown.js"></script> <script> var json_loc = ""versions.json"", target_loc = "../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href=index.html  class=md-tabs__link >ZigZag 2.0.0 documentation</a> <li class=md-tabs__item ><a href=user-guide.html  class=md-tabs__link >User Guide</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href=index.html  title="ZigZag 2.0.0 documentation" class="md-nav__button md-logo"> <img src="_static/" alt=" logo" width=48  height=48 > </a> <a href=index.html  title="ZigZag 2.0.0 documentation">ZigZag Framework</a> </label> <div class=md-nav__source > <a href="https://github.com/kuleuven-micas/zigzag" title="Go to repository" class=md-source  data-md-source=github > <div class=md-source__icon > <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width=28  height=28 > <use xlink:href="#__github" width=24  height=24 ></use> </svg> </div> <div class=md-source__repository > ZigZag Framework </div> </a> </div> <ul class=md-nav__list > <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Contents:</span></span> <li class=md-nav__item > <a href=installation.html  class=md-nav__link >Installation</a> <li class=md-nav__item > <a href=getting-started.html  class=md-nav__link >Getting Started</a> <li class=md-nav__item > <a href=api.html  class=md-nav__link >ZigZag API</a> <li class=md-nav__item > <a href=user-guide.html  class=md-nav__link >User Guide</a> <ul class=md-nav__list > <li class=md-nav__item > <a href=workload.html  class=md-nav__link >Workload</a> <li class=md-nav__item > <a href=hardware.html  class=md-nav__link >Hardware Architecture</a> <li class=md-nav__item > <a href=mapping.html  class=md-nav__link >Mapping</a> <li class=md-nav__item > <input class="md-toggle md-nav__toggle" data-md-toggle=toc  type=checkbox  id=__toc > <label class="md-nav__link md-nav__link--active" for=__toc > Stages </label> <a href="#" class="md-nav__link md-nav__link--active">Stages</a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#stages--page-root" class=md-nav__link >Stages</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#introduction" class=md-nav__link >Introduction</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#the-main-entry-point" class=md-nav__link >The main entry point</a> <li class=md-nav__item ><a href="#the-sequential-call-of-stages" class=md-nav__link >The sequential call of stages</a> <li class=md-nav__item ><a href="#the-back-passing-of-results" class=md-nav__link >The back passing of results</a> </ul> </nav> <li class=md-nav__item ><a href="#implemented-stages" class=md-nav__link >Implemented stages</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#input-parser-stages" class=md-nav__link >Input parser stages</a> <li class=md-nav__item ><a href="#iterator-stage" class=md-nav__link >Iterator stage</a> <li class=md-nav__item ><a href="#plot-stages" class=md-nav__link >Plot stages</a> <li class=md-nav__item ><a href="#reduce-stages" class=md-nav__link >Reduce stages</a> <li class=md-nav__item ><a href="#optimization-stages" class=md-nav__link >Optimization stages</a> <li class=md-nav__item ><a href="#save-and-dump-stages" class=md-nav__link >Save and dump stages</a> <li class=md-nav__item ><a href="#temporal-mapping-stages" class=md-nav__link >Temporal mapping stages</a> <li class=md-nav__item ><a href="#spatial-mapping-stages" class=md-nav__link >Spatial mapping stages</a> <li class=md-nav__item ><a href="#cost-model-stages" class=md-nav__link >Cost model stages</a> <li class=md-nav__item ><a href="#hardware-modification-stages" class=md-nav__link >Hardware modification stages</a> </ul> </nav> <li class=md-nav__item ><a href="#creating-your-custom-stage" class=md-nav__link >Creating your custom stage</a> </ul> </nav> <li class=md-nav__item ><a class=md-nav__extra_link  href="_sources/stages.rst.txt">Show Source</a> </ul> </nav> <li class=md-nav__item > <a href=outputs.html  class=md-nav__link >Outputs</a> <li class=md-nav__item > <a href=visualization.html  class=md-nav__link >Visualization</a> </ul> <li class=md-nav__item > <a href=future.html  class=md-nav__link >Future changes</a> <li class=md-nav__item > <a href=contribute.html  class=md-nav__link >Contribute</a> <li class=md-nav__item > <a href=publications.html  class=md-nav__link >Publications</a> <li class=md-nav__item > <a href=code-documentation.html  class=md-nav__link >Code Documentation</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#stages--page-root" class=md-nav__link >Stages</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#introduction" class=md-nav__link >Introduction</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#the-main-entry-point" class=md-nav__link >The main entry point</a> <li class=md-nav__item ><a href="#the-sequential-call-of-stages" class=md-nav__link >The sequential call of stages</a> <li class=md-nav__item ><a href="#the-back-passing-of-results" class=md-nav__link >The back passing of results</a> </ul> </nav> <li class=md-nav__item ><a href="#implemented-stages" class=md-nav__link >Implemented stages</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#input-parser-stages" class=md-nav__link >Input parser stages</a> <li class=md-nav__item ><a href="#iterator-stage" class=md-nav__link >Iterator stage</a> <li class=md-nav__item ><a href="#plot-stages" class=md-nav__link >Plot stages</a> <li class=md-nav__item ><a href="#reduce-stages" class=md-nav__link >Reduce stages</a> <li class=md-nav__item ><a href="#optimization-stages" class=md-nav__link >Optimization stages</a> <li class=md-nav__item ><a href="#save-and-dump-stages" class=md-nav__link >Save and dump stages</a> <li class=md-nav__item ><a href="#temporal-mapping-stages" class=md-nav__link >Temporal mapping stages</a> <li class=md-nav__item ><a href="#spatial-mapping-stages" class=md-nav__link >Spatial mapping stages</a> <li class=md-nav__item ><a href="#cost-model-stages" class=md-nav__link >Cost model stages</a> <li class=md-nav__item ><a href="#hardware-modification-stages" class=md-nav__link >Hardware modification stages</a> </ul> </nav> <li class=md-nav__item ><a href="#creating-your-custom-stage" class=md-nav__link >Creating your custom stage</a> </ul> </nav> <li class=md-nav__item ><a class=md-nav__extra_link  href="_sources/stages.rst.txt">Show Source</a> <li id=searchbox  class=md-nav__item > </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <section id=stages > <h1 id=stages--page-root >Stages<a class=headerlink  href="#stages--page-root" title="Permalink to this heading">¶</a></h1> <p>This document explains the concept of stages within the ZigZag framework. It details the different implemented stages and explains how to create your own.</p> <section id=introduction > <h2 id=introduction >Introduction<a class=headerlink  href="#introduction" title="Permalink to this heading">¶</a></h2> <p>Stages within ZigZag are used to modularly and easily adapt the functionality of the framework. The different stages and their sequence of execution determine the goal of running the framework. The sequence of stages the framework will run through are defined in the main file. An example as follows:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=n >mainstage</span> <span class=o >=</span> <span class=n >MainStage</span><span class=p >(</span>
    <span class=p >[</span>  <span class=c1 ># Initialize the MainStage as entry point</span>
        <span class=n >workload_parser_stage</span><span class=p >,</span>  <span class=c1 ># Parse the ONNX Model into the workload</span>
        <span class=n >AcceleratorParserStage</span><span class=p >,</span>  <span class=c1 ># Parse the accelerator module/passthrough given accelerator</span>
        <span class=n >SimpleSaveStage</span><span class=p >,</span>  <span class=c1 ># Save the summed CME energy and latency to a json</span>
        <span class=n >PickleSaveStage</span><span class=p >,</span>  <span class=c1 ># Save all received CMEs in a list to a pickle file</span>
        <span class=n >SumStage</span><span class=p >,</span>  <span class=c1 ># Sum up the received best CME across all layers of the workload</span>
        <span class=n >WorkloadStage</span><span class=p >,</span>  <span class=c1 ># Iterate through the different layers in the workload</span>
        <span class=n >VisualizationStage</span><span class=p >,</span>  <span class=c1 ># Save the chosen loop ordering and memory hierarchy</span>
        <span class=n >CompleteSaveStage</span><span class=p >,</span>  <span class=c1 ># Save each processed layer to a json</span>
        <span class=n >opt_stage</span><span class=p >,</span>  <span class=c1 ># Reduce all CMEs, returning minimal energy/latency one</span>
        <span class=n >SpatialMappingGeneratorStage</span><span class=p >,</span>  <span class=c1 ># Generate multiple spatial mappings (SM)</span>
        <span class=n >opt_stage</span><span class=p >,</span>  <span class=c1 ># Reduce all CMEs, returning minimal energy/latency one</span>
        <span class=n >LomaStage</span><span class=p >,</span>  <span class=c1 ># Generate multiple temporal mappings (TM)</span>

        <span class=n >CostModelStage</span><span class=p >,</span>  <span class=c1 ># Evaluate generated SM and TM through cost model</span>
    <span class=p >],</span>
    <span class=n >accelerator</span><span class=o >=</span><span class=n >args</span><span class=o >.</span><span class=n >accelerator</span><span class=p >,</span>  <span class=c1 ># required by AcceleratorParserStage</span>
    <span class=n >workload</span><span class=o >=</span><span class=n >args</span><span class=o >.</span><span class=n >workload</span><span class=p >,</span>  <span class=c1 ># required by workload_parser_stage</span>
    <span class=n >mapping</span><span class=o >=</span><span class=n >args</span><span class=o >.</span><span class=n >mapping</span><span class=p >,</span>  <span class=c1 ># required by workload_parser_stage</span>
    <span class=n >dump_folder</span><span class=o >=</span><span class=n >args</span><span class=o >.</span><span class=n >dump_folder</span><span class=p >,</span>  <span class=c1 ># output file save pattern</span>
    <span class=n >pickle_filename</span><span class=o >=</span><span class=n >args</span><span class=o >.</span><span class=n >pickle_filename</span><span class=p >,</span>  <span class=c1 ># filename for pickled list of cmes</span>
    <span class=n >loma_lpf_limit</span><span class=o >=</span><span class=n >args</span><span class=o >.</span><span class=n >lpf_limit</span><span class=p >,</span>  <span class=c1 ># required by LomaStage</span>
    <span class=n >loma_show_progress_bar</span><span class=o >=</span><span class=kc >True</span><span class=p >,</span>
    <span class=c1 ># Max nb of spatial mappings that are automatically generated in SpatialMappingGeneratorStage</span>
    <span class=n >nb_mappings_generated</span><span class=o >=</span><span class=n >nb_spatial_mappings_generated</span><span class=p >,</span>
    <span class=c1 ># Whether `mixed` mappings (e.g. `D1: {K:8, C:4}`) can be generated</span>
    <span class=n >enable_mix_spatial_mapping_generation</span><span class=o >=</span><span class=kc >False</span><span class=p >,</span>
    <span class=c1 ># If we need access the same input data multiple times from the innermost memory level and the data size is</span>
    <span class=c1 ># smaller than the memory read bw,</span>
    <span class=c1 ># take into account only one-time access cost (assume the data can stay at the output pins of the memory as</span>
    <span class=c1 ># long as it is needed).</span>
    <span class=c1 ># By default, if the parameter is not defined, it will be set as False internally.</span>
    <span class=n >access_same_data_considered_as_no_access</span><span class=o >=</span><span class=kc >True</span><span class=p >,</span>
<span class=p >)</span>

<span class=c1 ># Launch the MainStage</span>
<span class=n >cmes</span> <span class=o >=</span> <span class=n >mainstage</span><span class=o >.</span><span class=n >run</span><span class=p >()</span>
</pre></div> </div> <p>This corresponds to the following hierarchy:</p> <a class="reference internal image-reference" href="_images/zigzag-stages-1.jpg"><img alt="_images/zigzag-stages-1.jpg" src="_images/zigzag-stages-1.jpg" style="width: 800px;"/></a> <section id=the-main-entry-point > <h3 id=the-main-entry-point >The main entry point<a class=headerlink  href="#the-main-entry-point" title="Permalink to this heading">¶</a></h3> <p>You can think of stages similar to those in a pipelined system. The <code class="docutils literal notranslate"><span class=pre >MainStage</span></code> provides an entry point for the framework to start execution from. All stages save the provided first argument as the sequence of remaining stages, of which the first one will be called when running said stage. In our example, the <code class="docutils literal notranslate"><span class=pre >MainStage</span></code> will automatically call the <code class="docutils literal notranslate"><span class=pre >ONNXModelParserStage</span></code> with the remaining stages <code class="docutils literal notranslate"><span class=pre >[AcceleratorParserStage,</span> <span class=pre >SimpleSaveStage,</span> <span class=pre >...]</span></code> as its first argument. Besides the sequence of stages, the remaining arguments (e.g. <code class="docutils literal notranslate"><span class=pre >accelerator</span></code>, <code class="docutils literal notranslate"><span class=pre >onnx_model_path</span></code>, …) of the <code class="docutils literal notranslate"><span class=pre >MainStage</span></code> initialization are arguments required by one or more of the later stages. You can think of stages similar to those in a pipelined system. The <code class="docutils literal notranslate"><span class=pre >MainStage</span></code> provides an entry point for the framework to start execution from. All stages save the provided first argument as the sequence of remaining stages, of which the first one will be called when running said stage. In our example, the <code class="docutils literal notranslate"><span class=pre >MainStage</span></code> will automatically call the <code class="docutils literal notranslate"><span class=pre >ONNXModelParserStage</span></code> with the remaining stages <code class="docutils literal notranslate"><span class=pre >[AcceleratorParserStage,</span> <span class=pre >SimpleSaveStage,</span> <span class=pre >...]</span></code> as its first argument. Besides the sequence of stages, the remaining arguments (e.g. <code class="docutils literal notranslate"><span class=pre >accelerator</span></code>, <code class="docutils literal notranslate"><span class=pre >onnx_model_path</span></code>, …) of the <code class="docutils literal notranslate"><span class=pre >MainStage</span></code> initialization are arguments required by one or more of the later stages.</p> </section> <section id=the-sequential-call-of-stages > <h3 id=the-sequential-call-of-stages >The sequential call of stages<a class=headerlink  href="#the-sequential-call-of-stages" title="Permalink to this heading">¶</a></h3> <p>After the <code class="docutils literal notranslate"><span class=pre >MainStage</span></code> initialization, the remaining stages are called in an sequential order. The <code class="docutils literal notranslate"><span class=pre >ONNXModelParserStage</span></code> will call the <code class="docutils literal notranslate"><span class=pre >AcceleratorParserStage</span></code>, and so on.</p> <p>The <code class="docutils literal notranslate"><span class=pre >ONNXModelParserStage</span></code> parses the ONNX model into the workload and the <code class="docutils literal notranslate"><span class=pre >AcceleratorParserStage</span></code> parses the accelerator based on the hardware architecture description. After this, the <code class="docutils literal notranslate"><span class=pre >SimpleSaveStage</span></code> is called, which will save the results of the design space exploration in a file in a later step. Further description about this step can be found in <a class="reference internal" href="#back-passing-label">back-passing-label</a>.</p> <p>The <code class="docutils literal notranslate"><span class=pre >WorkloadStage</span></code> iterates through each layer in the parsed workload, and for each layer it finds spatial mappings (SM) in the <code class="docutils literal notranslate"><span class=pre >SpatialMappingGeneratorStage</span></code>. The temporal mapping generator stage below (<code class="docutils literal notranslate"><span class=pre >TemporalMappingGeneratorStage</span></code>) generates multiple temporal mappings (TM), and each SM + TM combination is fed to the cost model for HW cost evaluation.</p> </section> <section id=the-back-passing-of-results > <h3 id=the-back-passing-of-results >The back passing of results<a class=headerlink  href="#the-back-passing-of-results" title="Permalink to this heading">¶</a></h3> <p id=back-passing-label >So far, we have only discussed the sequential calling of stages from first to last. The reverse also holds true: when the <code class="docutils literal notranslate"><span class=pre >CostModelStage</span></code> finishes processing a SM + TM conbimation, it yields a CostModelEvaluation (CME) object back up the chain of stages. Some stages will simply pass this CME further up the chain, while others manipulate what is passed back up the chain. The <code class="docutils literal notranslate"><span class=pre >MinimalLatencyStage</span></code> for example, receives all the CMEs from the multiple cost model invocations for different TMs, but only passes the CME with the lowest latency back up the chain across all TMs. As such, the <code class="docutils literal notranslate"><span class=pre >SimpleSaveStage</span></code> only receives the CME with the lowest latency, which it will save to a file in the <code class="docutils literal notranslate"><span class=pre >dump_folder</span></code> folder.</p> </section> </section> <section id=implemented-stages > <h2 id=implemented-stages >Implemented stages<a class=headerlink  href="#implemented-stages" title="Permalink to this heading">¶</a></h2> <p>This section is still being updated. For a missing description, please look at the stages requirements in <a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/blob/master/zigzag/classes/stages/__init__.py">__init__.py</a> and the stage implementation in the <a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages">stages</a> folder.</p> <section id=input-parser-stages > <span id=custom-stages-label ></span><h3 id=input-parser-stages >Input parser stages<a class=headerlink  href="#input-parser-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/MainInputParserStages.py#L12">AcceleratorParserStage</a>: Parse the accelerator description from the inputs.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/MainInputParserStages.py#L47">WorkloadParserStage</a>: Parse the input workload residing in workload_path. Used when workload is defined manually by the user.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/ONNXModelParserStage.py#L11">ONNXModelParserStage</a>: Parse the input workload residing in onnx_model_path. Used when workload is defined through a ONNX model.</p> </ul> </section> <section id=iterator-stage > <h3 id=iterator-stage >Iterator stage<a class=headerlink  href="#iterator-stage" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/GeneralParameterIteratorStage.py#L10">GeneralParameterIteratorStage</a>: General iterator over any parameter whose values can be set from a predetermined list</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/WorkloadStage.py#L11">WorkloadStage</a>: Class that iterates through the nodes in a given workload graph.</p> </ul> </section> <section id=plot-stages > <h3 id=plot-stages >Plot stages<a class=headerlink  href="#plot-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/PlotTemporalMappingsStage.py#L11">PlotTemporalMappingsStage</a>: Class that passes through all results yielded by substages, but keeps the TMs cme’s and saves a plot.</p> </ul> </section> <section id=reduce-stages > <h3 id=reduce-stages >Reduce stages<a class=headerlink  href="#reduce-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/ReduceStages.py#L10">MinimalEnergyStage</a>: Class that keeps yields only the cost model evaluation that has minimal energy of all cost model evaluations generated by it’s substages created by list_of_callables</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/ReduceStages.py#L52">MinimalLatencyStage</a>: Class that keeps yields only the cost model evaluation that has minimal latency of all cost model evaluations generated by it’s substages created by list_of_callables</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/ReduceStages.py#L91">MinimalEDPStage</a>: Class that keeps yields only the cost model evaluation that has minimal EDP of all cost model evaluations generated by it’s substages created by list_of_callables</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/ReduceStages.py#L127">SumStage</a>: Class that keeps yields only the sum of all cost model evaluations generated by its substages created by list_of_callables</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/ReduceStages.py#L156">ListifyStage</a>: Class yields all the cost model evaluations yielded by its substages as a single list instead of as a generator.</p> </ul> </section> <section id=optimization-stages > <h3 id=optimization-stages >Optimization stages<a class=headerlink  href="#optimization-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/RunOptStages.py#L11">RemoveExtraInfoStage</a>: Strips extra info for subcallables to save memory</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/RunOptStages.py#L33">CacheBeforeYieldStage</a>: Caches results in a list and then yields them. This breaks the yield flow from top to bottom.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/RunOptStages.py#L59">SkipIfDumpExistsStage</a>: Check if the output file is already generated, skip the run if so.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/RunOptStages.py#L114">MultiProcessingSpawnStage</a>: Multiprocessing support stage.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/RunOptStages.py#L159">MultiProcessingGatherStage</a>: Multiprocessing support stage.</p> </ul> </section> <section id=save-and-dump-stages > <h3 id=save-and-dump-stages >Save and dump stages<a class=headerlink  href="#save-and-dump-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/SaveStage.py#L14">CompleteSaveStage</a>: Class that passes through all results yielded by substages, but saves the results as a json list to a file at the end of the iteration.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/SaveStage.py#L74">SimpleSaveStage</a>: Class that passes through results yielded by substages, but saves the results as a json list to a file at the end of the iteration. In this simple version, only the energy total and latency total are saved.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/SaveStage.py#L133">PickleSaveStage</a>: Class that dumps all received CMEs into a list and saves that list to a pickle file.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/DumpStage.py#L8">DumpStage</a>: Class that passes through all results yielded by substages, but dumps the results as a pickled list to a file at the end of the iteration</p> </ul> </section> <section id=temporal-mapping-stages > <h3 id=temporal-mapping-stages >Temporal mapping stages<a class=headerlink  href="#temporal-mapping-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/TemporalMappingGeneratorStage.py#L10">TemporalMappingGeneratorStage</a>: Class that iterates through the different temporal mappings generated through the loop order based memory allocation (loma) engine</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/SalsaStage.py#L47">SalsaStage</a>: Class that return the best temporal mapping found by the Simulated Annealing Loop-ordering Scheduler for Accelerators (SALSA) for a single layer.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/TemporalOrderingConversionStage.py#L10">TemporalOrderingConversionStage</a>: Run this stage by converting the user-defined temporal loop ordering to the memory-level based temporal mapping representation.</p> </ul> </section> <section id=spatial-mapping-stages > <h3 id=spatial-mapping-stages >Spatial mapping stages<a class=headerlink  href="#spatial-mapping-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/SpatialMappingConversionStage.py#L11">SpatialMappingConversionStage</a>: Pipeline stage that converts the spatial mapping from user-provided spatial mapping across operational array dimensions to the internal spatial mapping representation used in the cost model.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/SpatialMappingGeneratorStage.py#L12">SpatialMappingGeneratorStage</a>: Pipeline stage that finds spatial mappings given a accelerator, core allocation, interconnection pattern on the allocated core and a layer. The spatial mappings are found using the interconnection pattern present on the core. The inner-most memory level served dimensions is used, as this is how the memories connect to the operational array.</p> </ul> </section> <section id=cost-model-stages > <h3 id=cost-model-stages >Cost model stages<a class=headerlink  href="#cost-model-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/tree/master/zigzag/classes/stages/CostModelStage.py#L15">CostModelStage</a>: Pipeline stage that calls a cost model to evaluate a (temporal and spatial) mapping on a hardware config.</p> </ul> </section> <section id=hardware-modification-stages > <h3 id=hardware-modification-stages >Hardware modification stages<a class=headerlink  href="#hardware-modification-stages" title="Permalink to this heading">¶</a></h3> <ul class=simple > <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/blob/master/zigzag/classes/stages/SearchInterLayerDataLocalityStage.py#L74">SearchInterLayerDataLocalityStage</a>: Class that iterates through the memory instances and return the lowest allowed memory level for each operand for the usage of the next layer. The class must be placed before the WorkloadStage. The parameter <a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/blob/master/zigzag/classes/stages/SearchInterLayerDataLocalityStage.py#L164">workload_data_always_from_top_mem</a> is False by default, which means the initial input and final output of the entire workload can be from a memory level lower than the highest memory level. You can set it to True if the initial input data and final output of the entire workload must travel from/to the highest memory level.</p> <li><p><a class="reference external" href="https://github.com/KULeuven-MICAS/zigzag/blob/master/zigzag/classes/stages/ExploitInterLayerDataLocalityStage.py#L34">ExploitInterLayerDataLocalityStage</a>: Class that remove the unused memory instances according to the result of SearchInterLayerDataLocalityStage. Each memory instance with a level higher than the level returned from SearchInterLayerDataLocalityStage will be considered as an unused memory and will be removed. This stage must be placed after the WorkloadStage.</p> </ul> </section> </section> <section id=creating-your-custom-stage > <h2 id=creating-your-custom-stage >Creating your custom stage<a class=headerlink  href="#creating-your-custom-stage" title="Permalink to this heading">¶</a></h2> <p>Let’s say you are not interested in saving the CME with minimal energy, but want to save based on another metric provided by the CME, or you want to define a new temporal mapping generator stage, you can easily create a custom stage. The easiest way is copying an existing stage class definition, and modifying it according to your intended behaviour. To guarantee correctness, following aspects have to be taken into account when creating a custom stage:</p> <ul class=simple > <li><p>It must inherit from the abstract <code class="docutils literal notranslate"><span class=pre >Stage</span></code> class.</p> <li><p>It must create its <code class="docutils literal notranslate"><span class=pre >substage</span></code> as the first element of the list of callables, with the remaining list as its first argument, and <code class="docutils literal notranslate"><span class=pre >**kwargs</span></code> as the second argument. These kwargs can be updated to change e.g. the accelerator, spatial mapping, temporal mapping, etc.</p> <li><p>It must iterate over the different <code class="docutils literal notranslate"><span class=pre >(CME,</span> <span class=pre >extra_info)</span></code> tuples yielded by the <code class="docutils literal notranslate"><span class=pre >substage.run()</span></code> call in a for loop.</p> <li><p>If the stage is a reduction (like e.g. the <code class="docutils literal notranslate"><span class=pre >MinimalLatencyStage</span></code>), its <code class="docutils literal notranslate"><span class=pre >yield</span></code> statement must be outside the for loop which iterates over the returned <code class="docutils literal notranslate"><span class=pre >(CME,</span> <span class=pre >extra_info)</span></code> tuples, where some processing happens inside the for loop.</p> </ul> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> <a href=mapping.html  title=Mapping  class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev > <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis > <span class=md-footer-nav__direction > "Previous" </span> Mapping </span> </div> </a> <a href=outputs.html  title=Outputs  class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next > <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class=md-flex__ellipsis > <span class=md-footer-nav__direction > "Next" </span> Outputs </span> </div> <div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2022, Arne Symons. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.1.2. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>